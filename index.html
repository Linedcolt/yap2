<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Static PWA Chat (GitHub Pages)</title>
  <meta name="theme-color" content="#0a0a0a" />
  <link rel="manifest" href="manifest.json" />
  <style>
    :root{--bg:#0f1720;--panel:#0b1220;--muted:#AAB3C2;--accent:#3b82f6}
    html,body{height:100%;margin:0;font-family:Inter, system-ui, sans-serif;background:var(--bg);color:#e6eef6}
    .wrap{max-width:900px;margin:32px auto;padding:18px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));border-radius:12px;box-shadow:0 6px 30px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;gap:12px}
    h1{font-size:18px;margin:0}
    #messages{height:60vh;overflow:auto;padding:12px;background:rgba(0,0,0,0.12);border-radius:8px;margin-top:12px}
    .msg{padding:8px 10px;border-radius:8px;margin-bottom:8px;background:rgba(255,255,255,0.02)}
    .meta{font-size:12px;color:var(--muted)}
    form{display:flex;gap:8px;margin-top:12px}
    input[type=text]{flex:1;padding:10px;border-radius:8px;border:1px solid rgba(255,255,255,0.04);background:transparent;color:inherit}
    button{padding:10px 14px;border-radius:8px;border:0;background:var(--accent);color:white}
    .small{font-size:13px;color:var(--muted);margin-top:6px}
  </style>
</head>
<body>
  <div class="wrap" role="main">
    <header>
      <svg width="36" height="36" viewBox="0 0 24 24" fill="none" aria-hidden><rect width="24" height="24" rx="6" fill="#0b1220"/><path d="M8 12h8M8 8h8M8 16h5" stroke="#3b82f6" stroke-width="1.6" stroke-linecap="round"/></svg>
      <div>
        <h1>Static PWA Chat — GitHub Pages + Pusher</h1>
        <div class="small">Static front-end (this file) + small server to trigger Pusher events</div>
      </div>
    </header>

    <div id="messages" aria-live="polite"></div>

    <form id="sendForm" onsubmit="return false">
      <input id="nameInput" type="text" placeholder="Your name" value="" required />
      <input id="textInput" type="text" placeholder="Write a message..." autocomplete="off" required />
      <button id="sendBtn">Send</button>
    </form>

    <div class="small">
      Notes: This frontend subscribes to Pusher Channels to *receive* messages. To send messages you'll POST to a server that triggers Pusher (secure). See setup steps below.
    </div>
  </div>

  <!-- Pusher JS (CDN) -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/pusher/8.4.0/pusher.min.js" integrity="" crossorigin="anonymous"></script>

  <script>
    // --- CONFIG (replace with your app values) ---
    const PUSHER_KEY = 'e5f9c3ee60eeb37aac63';
    const PUSHER_CLUSTER = 'ap1';
    const SERVER_SEND_ENDPOINT = 'https://YOUR-SERVER.example.com/message'; // Node server example below

    // --- UI helpers ---
    const messagesEl = document.getElementById('messages');
    const nameInput = document.getElementById('nameInput');
    const textInput = document.getElementById('textInput');
    const sendForm = document.getElementById('sendForm');

    function addMessage({name, text, ts}) {
      const d = document.createElement('div');
      d.className = 'msg';
      d.innerHTML = `<div class="meta"><strong>${escapeHtml(name)}</strong> • ${new Date(ts||Date.now()).toLocaleTimeString()}</div><div>${escapeHtml(text)}</div>`;
      messagesEl.appendChild(d);
      messagesEl.scrollTop = messagesEl.scrollHeight;
    }
    function escapeHtml(s){ return String(s).replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'})[m]); }

    // --- Pusher client: subscribe + bind ---
    const pusher = new Pusher(PUSHER_KEY, {
      cluster: PUSHER_CLUSTER,
      forceTLS: true,
    });

    // public channel for demo; pick a channel like "public-chat"
    const channel = pusher.subscribe('public-chat');
    channel.bind('new-message', function(data) {
      // data = { name, text, ts }
      addMessage(data);
    });

    // --- send: POST to server which triggers Pusher events ---
    sendForm.addEventListener('submit', async (e) => {
      const name = nameInput.value.trim() || 'Anonymous';
      const text = textInput.value.trim();
      if (!text) return;
      // optimistic UI (optional)
      addMessage({name, text, ts: Date.now()});
      textInput.value = '';
      try {
        await fetch(SERVER_SEND_ENDPOINT, {
          method: 'POST',
          headers: {'Content-Type':'application/json'},
          body: JSON.stringify({ name, text })
        });
      } catch (err) {
        console.error('Send error', err);
        // optionally show failed indicator
      }
    });

    // --- small footprint PWA install hint (optional) ---
    if ('serviceWorker' in navigator) {
      navigator.serviceWorker.register('/sw.js').catch(()=>{/* ignore if not present */});
    }
  </script>
</body>
</html>
